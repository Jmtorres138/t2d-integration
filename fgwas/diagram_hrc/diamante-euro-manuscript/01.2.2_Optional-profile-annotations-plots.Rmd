---
title: "Plot annotation profiles"
author: "Jason Torres"
date: "August 14, 2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Setup libraries and directories 

```{r}
"%&%" <- function(a,b) paste0(a,b) 
library("dplyr")
library("data.table")
library("ggplot2")
library("gridExtra")

serv.dir <- "/Users/jtorres/FUSE/"
fgwas.dir <- serv.dir %&% "projects/t2d-integration/fgwas/diagram_hrc/diamante-euro-manuscript/"
fgwas.input.dir <- fgwas.dir %&% "fgwas_input/"

prof.file <- fgwas.input.dir %&% "test.temp.txt" #"gwas-annotation-profile.txt"

```


# Plotting 

```{r}

make_overlap_plot <- function(prof.file){
  prof.df <- fread(prof.file)
  prof.df$Prop1 <- prof.df$Overlap / prof.df$Count1
  plot.df <- data.frame("X"=prof.df$Name1,"Y"=prof.df$Name2,"Overlap"=(prof.df$Prop1))
  plot.df <- filter(plot.df,Overlap<=1)
  plt <- ggplot(plot.df, aes(X, Y, z= Overlap)) + geom_tile(aes(fill = Overlap),color="black") + 
      geom_text(label=prettyNum(round(plot.df$Overlap,2),2),color="dodgerblue4") + theme_bw() + 
      xlab("Reference Annotation") + ylab("Query Annotation") +
      scale_fill_continuous(low="dodgerblue4",high="green2",na.value="ghostwhite") + 
      theme(panel.background=element_rect(fill="gray80"),
            panel.grid=element_blank())  
  return(plt)
}

make_count_plot <- function(prof.file){
  prof.df <- fread(prof.file)
  prof.df <- select(prof.df,one_of("Name2","Count2"))
  prof.df <- prof.df[!duplicated(prof.df),]
  names(prof.df) <- c("Annotation","Count in GWAS")
  plt <- ggplot(data=prof.df,aes(x=reorder(`Annotation`,-`Count in GWAS`)
                                 ,y=`Count in GWAS`)) + 
    geom_bar(stat="identity",color="black",fill="dodgerblue3") + 
    scale_y_continuous(limits=c(0,10000000),breaks=seq(0,10000000,500000)) + 
    theme_bw() + theme(panel.grid.minor.y=element_blank(),
                       panel.grid.major.y=element_line(color="black",linetype=2),
                       axis.text.x=element_text(angle=-90,vjust=0.5))
  return(plt)
}



make_overlap_plot(prof.file)

```


